import numpy as np
from PIL import Image
import sys
import glob
import errno
import os 
result=[]
temp1=np.zeros((256,256))
image = np.zeros((256,256))
i,j,p=0,0,0
path = r"C:\\malware_sample\\benign_dataset\\" ## Absolute path for the database.
dirs = os.listdir( path ) ## gets all the directories in the given folder.
path2 = r"C:\\malware_sample\\images\\image256\\" ## Absolute path for storing 256x256 image.
os.makedirs(path2, exist_ok=True)

path3 = r"C:\\malware_sample\\images\\image36\\"  ## Absolute path for storing 36x36 image.
os.makedirs(path3, exist_ok=True)

for fil in dirs:
    image = np.zeros((256,256))
    with open(path+fil, "rb") as f: ## read byte mode
        byte = f.read(1)  ## reading 1 byte at a time. returns a byte object.
        i,j,p=0,0,0
        print(fil)
        #print (byte)
        while byte != b"":  # 파일 끝까지 읽기
            if byte not in (b' ', b'\r', b'\n', b'?'):  # 바이너리 값으로 직접 비교
                if i < 256:
                    if j > 8:
                        try:
                            image[i][p] = int.from_bytes(byte, byteorder='big')  # 바이트 → 정수 변환
                            p += 1
                        except ValueError:
                            pass
                    j += 1
                    if p > 255:
                        p = 0
                        j = 0
                        i += 1
            byte = f.read(1)
        a=np.matrix(image)
        # a=np.matrix(image)
        print (a)
        result.append(np.array_equal(temp1,a))
        temp1=a
        img = Image.fromarray(image, 'L') ## makes 2D array into an image. L-> The kind of pixel (8-bit pixel black and white)
        #img.show()
        filename_noext, ext = os.path.splitext(fil)
        # 256×256 .bmp 저장
        img.save(os.path.join(path2, filename_noext + ".bmp"))
        
        # 36×36으로 리사이즈 후 저장
        img_36 = img.resize((36, 36), Image.ANTIALIAS)
        img_36.save(os.path.join(path3, filename_noext + ".bmp"))
        #img.show()
print (result)



# with open('C:/Users/admin/Project IAS/data/sample/0fHVZKeTE6iRb1PIQ4au.bytes', 'r') as file1:
#     print(file1.read())
# import pandas as pd
# df = pd.read_csv("C:/Users/admin/Project IAS/data/sample/0fHVZKeTE6iRb1PIQ4au.bytes")
# print(df.drop([0]))
# with open('C:/Users/admin/Project IAS/data/sample/0gDsIvrylX5fPbG7cSBn.bytes', 'r') as file2:
#     print(file2.read())
'''
#same.discard('\n')

# with open('some_output_file.txt', 'w') as file_out:
#     for line in same:
#         file_out.write(line)

with open("apt1/APT1/VirusShare_00dbb9e1c09dbdafb360f3163ba5a3de.json", "rb") as f:
    byte = f.read(1)
    while byte:
        #print ord(byte)
        if(i<256):
            image[i][j]=ord(byte)
            j=j+1
            if(j>255):
                j=0
                i=i+1
        byte = f.read(1)

print(np.matrix(image))
img = Image.fromarray(image, 'L')
img.show()
img = img.resize((36,36),Image.ANTIALIAS)
img.show()

'''
